#!/usr/bin/env bash
set -euo pipefail
# Resolve symlinks to get the actual script location
SCRIPT_PATH="$(readlink -f "${BASH_SOURCE[0]}")"
SCRIPT_DIR="$(cd "$(dirname "${SCRIPT_PATH}")" && pwd)"
APP_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"
VENV_DIR="${APP_ROOT}/libexec/mycli-venv"

# Try different python executable names and check if they exist and are executable
if [[ -f "${VENV_DIR}/bin/python3" ]] && [[ -x "${VENV_DIR}/bin/python3" ]]; then
    PYTHON="${VENV_DIR}/bin/python3"
elif [[ -f "${VENV_DIR}/bin/python" ]] && [[ -x "${VENV_DIR}/bin/python" ]]; then
    PYTHON="${VENV_DIR}/bin/python"
elif [[ -f "${VENV_DIR}/bin/python3.12" ]] && [[ -x "${VENV_DIR}/bin/python3.12" ]]; then
    PYTHON="${VENV_DIR}/bin/python3.12"
else
    echo "Error: Could not locate executable python interpreter in libexec/mycli-venv" >&2
    echo "Available files in ${VENV_DIR}/bin/:" >&2
    ls -la "${VENV_DIR}/bin/" 2>/dev/null || echo "Directory ${VENV_DIR}/bin does not exist" >&2
    exit 1
fi

exec "${PYTHON}" -m mycli_app "$@"
